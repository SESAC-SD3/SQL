
## 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

### 1.1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° ì„ íƒ

```sql
-- ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ (ì£¼ì˜: ëª¨ë“  ë°ì´í„° ì‚­ì œë¨)
DROP DATABASE IF EXISTS instaclone;

-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE instaclone
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

-- ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
USE instaclone;
```

**ì„¤ëª…:**
- `utf8mb4`: ì´ëª¨ì§€ í¬í•¨ ëª¨ë“  ìœ ë‹ˆì½”ë“œ ë¬¸ì ì§€ì›
- `utf8mb4_unicode_ci`: ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ëŠ” ì •ë ¬

---

### 1.2. í…Œì´ë¸” ëª©ë¡ í™•ì¸

```sql
-- ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  í…Œì´ë¸” í™•ì¸
SHOW TABLES;
```

---

## 2. í…Œì´ë¸” ìƒì„±

### 2.1. Users (ì‚¬ìš©ì)

```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    profile_image_url VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**ì œì•½ì¡°ê±´ ì„¤ëª…:**
- `PRIMARY KEY AUTO_INCREMENT`: user_idê°€ ê¸°ë³¸ í‚¤ì´ë©° ìë™ ì¦ê°€
- `UNIQUE`: usernameê³¼ emailì€ ì¤‘ë³µ ë¶ˆê°€

---

### 2.2. Posts (ê²Œì‹œë¬¼)

```sql
CREATE TABLE posts (
    post_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    content TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**ì™¸ë˜ í‚¤ ì„¤ëª…:**
- `FOREIGN KEY`: user_idëŠ” users í…Œì´ë¸” ì°¸ì¡°
- `ON DELETE CASCADE`: ì‚¬ìš©ì ì‚­ì œ ì‹œ ê²Œì‹œë¬¼ë„ í•¨ê»˜ ì‚­ì œ
- `ON UPDATE CASCADE`: user_id ë³€ê²½ ì‹œ ìë™ ë°˜ì˜

---

### 2.3. Media (ë¯¸ë””ì–´)

```sql
CREATE TABLE media (
    media_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    media_url VARCHAR(255) NOT NULL,
    media_type ENUM('IMAGE', 'VIDEO') NOT NULL,
    media_order TINYINT NOT NULL DEFAULT 1,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**ì œì•½ì¡°ê±´ ì„¤ëª…:**
- `ENUM`: media_typeì€ 'IMAGE' ë˜ëŠ” 'VIDEO'ë§Œ í—ˆìš©
- `FOREIGN KEY`: post_idëŠ” posts í…Œì´ë¸” ì°¸ì¡°

---

### 2.4. Comments (ëŒ“ê¸€)

```sql
CREATE TABLE comments (
    comment_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    content VARCHAR(500) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**ì™¸ë˜ í‚¤ ì„¤ëª…:**
- `FOREIGN KEY (post_id)`: posts í…Œì´ë¸” ì°¸ì¡°
- `FOREIGN KEY (user_id)`: users í…Œì´ë¸” ì°¸ì¡°
- `ON DELETE CASCADE`: ê²Œì‹œë¬¼ ë˜ëŠ” ì‚¬ìš©ì ì‚­ì œ ì‹œ ê´€ë ¨ ëŒ“ê¸€ë„ í•¨ê»˜ ì‚­ì œ

---

### 2.5. Likes (ì¢‹ì•„ìš”)

```sql
CREATE TABLE likes (
    like_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**ì™¸ë˜ í‚¤ ì„¤ëª…:**
- `FOREIGN KEY (post_id)`: posts í…Œì´ë¸” ì°¸ì¡°
- `FOREIGN KEY (user_id)`: users í…Œì´ë¸” ì°¸ì¡°
- `ON DELETE CASCADE`: ê²Œì‹œë¬¼ ë˜ëŠ” ì‚¬ìš©ì ì‚­ì œ ì‹œ ê´€ë ¨ ì¢‹ì•„ìš”ë„ í•¨ê»˜ ì‚­ì œ

---

## 3. ìƒ˜í”Œ ë°ì´í„° ì‚½ì…

### 3.1. Users ë°ì´í„°

```sql
INSERT INTO users (username, email, password_hash, full_name, profile_image_url) VALUES
('chulsoo', 'chulsoo@example.com', 'hash1234', 'ê¹€ì² ìˆ˜', 'https://example.com/profile1.jpg'),
('younghee', 'younghee@example.com', 'hash5678', 'ì´ì˜í¬', 'https://example.com/profile2.jpg'),
('minsu', 'minsu@example.com', 'hash9101', 'ë°•ë¯¼ìˆ˜', 'https://example.com/profile3.jpg'),
('jieun', 'jieun@example.com', 'hash1121', 'ìµœì§€ì€', 'https://example.com/profile4.jpg'),
('sangho', 'sangho@example.com', 'hash3141', 'ì •ìƒí˜¸', 'https://example.com/profile5.jpg'),
('sora', 'sora@example.com', 'hash5161', 'ê¹€ì†Œë¼', 'https://example.com/profile6.jpg'),
('junho', 'junho@example.com', 'hash7181', 'ì´ì¤€í˜¸', 'https://example.com/profile7.jpg'),
('hana', 'hana@example.com', 'hash9202', 'ë°•í•˜ë‚˜', 'https://example.com/profile8.jpg');
```

**ë°ì´í„° í™•ì¸:**
```sql
SELECT user_id, username, full_name, created_at FROM users;
```

---

### 3.2. Posts ë°ì´í„°

```sql
INSERT INTO posts (user_id, content) VALUES
(1, 'ì œì£¼ë„ ì—¬í–‰ ì¤‘ ì°ì€ ì‚¬ì§„ì…ë‹ˆë‹¤! ğŸŒ´'),
(1, 'ì˜¤ëŠ˜ì˜ ì¼ìƒ ê¸°ë¡'),
(2, 'ì¹´í˜ì—ì„œ ë§›ìˆëŠ” ë¸ŒëŸ°ì¹˜ ğŸ˜‹'),
(2, 'ìƒˆë¡œ ì‚° ì±… ì†Œê°œ'),
(3, 'ì„œìš¸ ì•¼ê²½ ì´¬ì˜'),
(3, 'ì£¼ë§ ì‚°ì±… ì½”ìŠ¤'),
(4, 'ì˜¤ëŠ˜ ë“¤ì€ ë…¸ë˜ ì¶”ì²œ'),
(5, 'í—¬ìŠ¤ì¥ ìš´ë™ ë£¨í‹´'),
(6, 'ê°•ë‚¨ ë§›ì§‘ ë°œê²¬!'),
(7, 'ì½”ë”© ê³µë¶€ ì¤‘'),
(8, 'ê·¸ë¦¼ ê·¸ë¦¬ê¸° ì·¨ë¯¸'),
(1, 'ì¼ëª° ì‚¬ì§„');
```

**ë°ì´í„° í™•ì¸:**
```sql
SELECT p.post_id, u.username, p.content, p.created_at
FROM posts p
JOIN users u ON p.user_id = u.user_id
ORDER BY p.created_at DESC;
```

---

### 3.3. Media ë°ì´í„°

```sql
INSERT INTO media (post_id, media_url, media_type, media_order) VALUES
(1, 'https://example.com/media/post1_1.jpg', 'IMAGE', 1),
(1, 'https://example.com/media/post1_2.jpg', 'IMAGE', 2),
(1, 'https://example.com/media/post1_3.jpg', 'IMAGE', 3),
(2, 'https://example.com/media/post2_1.jpg', 'IMAGE', 1),
(3, 'https://example.com/media/post3_1.jpg', 'IMAGE', 1),
(3, 'https://example.com/media/post3_2.jpg', 'IMAGE', 2),
(4, 'https://example.com/media/post4_1.jpg', 'IMAGE', 1),
(5, 'https://example.com/media/post5_1.jpg', 'IMAGE', 1),
(6, 'https://example.com/media/post6_1.mp4', 'VIDEO', 1),
(7, 'https://example.com/media/post7_1.jpg', 'IMAGE', 1),
(8, 'https://example.com/media/post8_1.jpg', 'IMAGE', 1),
(9, 'https://example.com/media/post9_1.jpg', 'IMAGE', 1),
(9, 'https://example.com/media/post9_2.jpg', 'IMAGE', 2),
(10, 'https://example.com/media/post10_1.jpg', 'IMAGE', 1),
(11, 'https://example.com/media/post11_1.jpg', 'IMAGE', 1),
(12, 'https://example.com/media/post12_1.jpg', 'IMAGE', 1),
(12, 'https://example.com/media/post12_2.jpg', 'IMAGE', 2),
(12, 'https://example.com/media/post12_3.jpg', 'IMAGE', 3),
(12, 'https://example.com/media/post12_4.jpg', 'IMAGE', 4);

```

**ë°ì´í„° í™•ì¸:**
```sql
SELECT p.post_id, u.username,
       COUNT(m.media_id) as media_count
FROM posts p
JOIN users u ON p.user_id = u.user_id
LEFT JOIN media m ON p.post_id = m.post_id
GROUP BY p.post_id, u.username;
```

---

### 3.4. Comments ë°ì´í„°

```sql
INSERT INTO comments (post_id, user_id, content) VALUES
(1, 2, 'ë©‹ì§„ ì‚¬ì§„ì´ë„¤ìš”!'),
(1, 3, 'ì €ë„ ê°€ë³´ê³  ì‹¶ì–´ìš”'),
(1, 1, 'ê°ì‚¬í•©ë‹ˆë‹¤!'),
(2, 4, 'ë§›ìˆì–´ ë³´ì—¬ìš”!'),
(2, 5, 'ì¢‹ì€ ì‚¬ì§„ì´ì—ìš”'),
(4, 1, 'ì¦ê±°ìš´ ì‹œê°„ ë³´ë‚´ì…¨ë‚˜ ë´ìš”!'),
(4, 6, 'ë‹¤ìŒì—” ì €ë„ ê°™ì´ ê°€ìš”!'),
(6, 7, 'ë…¸ì„ì´ ì •ë§ ì˜ˆì˜ë„¤ìš”'),
(6, 8, 'ë©‹ì§„ í’ê²½ì´ë„¤ìš”!'),
(8, 2, 'ì˜¤ëŠ˜ë„ íŒŒì´íŒ…!'),
(9, 3, 'ë§›ìˆê² ë‹¤!'),
(9, 6, 'ì™„ì „ ê³µê°ì´ì—ìš”!');
```

**ë°ì´í„° í™•ì¸:**
```sql
SELECT c.comment_id, u.username, p.post_id, c.content
FROM comments c
JOIN users u ON c.user_id = u.user_id
JOIN posts p ON c.post_id = p.post_id
ORDER BY c.post_id, c.comment_id;
```

---

### 3.5. Likes ë°ì´í„°

```sql
INSERT INTO likes (post_id, user_id) VALUES
(1, 2), (1, 3), (1, 4), (1, 5), (1, 6),
(2, 3), (2, 4), (2, 5),
(3, 1), (3, 4),
(4, 1), (4, 3), (4, 5), (4, 6),
(5, 2),
(6, 1), (6, 2), (6, 4), (6, 5), (6, 7), (6, 8),
(7, 1), (7, 2),
(8, 1), (8, 3), (8, 4),
(9, 1), (9, 2), (9, 3), (9, 4), (9, 5),
(10, 2),
(11, 3), (11, 4),
(12, 2), (12, 3), (12, 4), (12, 5);
```

**ë°ì´í„° í™•ì¸:**
```sql
SELECT p.post_id, u.username,
       COUNT(l.like_id) as likes_count
FROM posts p
JOIN users u ON p.user_id = u.user_id
LEFT JOIN likes l ON p.post_id = l.post_id
GROUP BY p.post_id, u.username
ORDER BY likes_count DESC;
```

---

## 4. ì œì•½ì¡°ê±´ í…ŒìŠ¤íŠ¸

### 4.1. UNIQUE ì œì•½ì¡°ê±´ í…ŒìŠ¤íŠ¸

```sql
-- âŒ ì‹¤íŒ¨: username ì¤‘ë³µ
INSERT INTO users (username, email, password_hash)
VALUES ('chulsoo', 'chulsoo2@example.com', 'hash1234');
-- Error: Duplicate entry 'chulsoo' for key 'username'

-- âœ… ì„±ê³µ: ë‹¤ë¥¸ username
INSERT INTO users (username, email, password_hash)
VALUES ('chulsoo2', 'chulsoo2@example.com', 'hash1234');
```

---

### 4.2. FK CASCADE í…ŒìŠ¤íŠ¸

```sql
-- ì‚¬ìš©ì ì‚­ì œ ì‹œ ê´€ë ¨ ë°ì´í„°ë„ ì‚­ì œë˜ëŠ”ì§€ í™•ì¸

-- 1. user_id = 8 ì‚­ì œ ì „ í™•ì¸
SELECT COUNT(*) FROM posts WHERE user_id = 8;  -- 1
SELECT COUNT(*) FROM comments WHERE user_id = 8;  -- 2
SELECT COUNT(*) FROM likes WHERE user_id = 8;  -- 0

-- 2. ì‚¬ìš©ì ì‚­ì œ
-- DELETE FROM users WHERE user_id = 8;

-- 3. ê´€ë ¨ ë°ì´í„° í™•ì¸ (ëª¨ë‘ 0ì´ì–´ì•¼ í•¨)
-- SELECT COUNT(*) FROM posts WHERE user_id = 8;  -- 0
-- SELECT COUNT(*) FROM comments WHERE user_id = 8;  -- 0
-- SELECT COUNT(*) FROM likes WHERE user_id = 8;  -- 0
```

