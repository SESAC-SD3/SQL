
## 1. 데이터베이스 생성

### 1.1. 데이터베이스 생성 및 선택

```sql
-- 기존 데이터베이스 삭제 (주의: 모든 데이터 삭제됨)
DROP DATABASE IF EXISTS instaclone;

-- 데이터베이스 생성
CREATE DATABASE instaclone
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

-- 데이터베이스 선택
USE instaclone;
```

**설명:**
- `utf8mb4`: 이모지 포함 모든 유니코드 문자 지원
- `utf8mb4_unicode_ci`: 대소문자 구분 없는 정렬

---

### 1.2. 테이블 목록 확인

```sql
-- 데이터베이스의 모든 테이블 확인
SHOW TABLES;
```

---

## 2. 테이블 생성

### 2.1. Users (사용자)

```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    profile_image_url VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**제약조건 설명:**
- `PRIMARY KEY AUTO_INCREMENT`: user_id가 기본 키이며 자동 증가
- `UNIQUE`: username과 email은 중복 불가

---

### 2.2. Posts (게시물)

```sql
CREATE TABLE posts (
    post_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    content TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**외래 키 설명:**
- `FOREIGN KEY`: user_id는 users 테이블 참조
- `ON DELETE CASCADE`: 사용자 삭제 시 게시물도 함께 삭제
- `ON UPDATE CASCADE`: user_id 변경 시 자동 반영

---

### 2.3. Media (미디어)

```sql
CREATE TABLE media (
    media_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    media_url VARCHAR(255) NOT NULL,
    media_type ENUM('IMAGE', 'VIDEO') NOT NULL,
    media_order TINYINT NOT NULL DEFAULT 1,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**제약조건 설명:**
- `ENUM`: media_type은 'IMAGE' 또는 'VIDEO'만 허용
- `FOREIGN KEY`: post_id는 posts 테이블 참조

---

### 2.4. Comments (댓글)

```sql
CREATE TABLE comments (
    comment_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    content VARCHAR(500) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**외래 키 설명:**
- `FOREIGN KEY (post_id)`: posts 테이블 참조
- `FOREIGN KEY (user_id)`: users 테이블 참조
- `ON DELETE CASCADE`: 게시물 또는 사용자 삭제 시 관련 댓글도 함께 삭제

---

### 2.5. Likes (좋아요)

```sql
CREATE TABLE likes (
    like_id INT PRIMARY KEY AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(post_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

**외래 키 설명:**
- `FOREIGN KEY (post_id)`: posts 테이블 참조
- `FOREIGN KEY (user_id)`: users 테이블 참조
- `ON DELETE CASCADE`: 게시물 또는 사용자 삭제 시 관련 좋아요도 함께 삭제

---

## 3. 샘플 데이터 삽입

### 3.1. Users 데이터

```sql
INSERT INTO users (username, email, password_hash, full_name, profile_image_url) VALUES
('chulsoo', 'chulsoo@example.com', 'hash1234', '김철수', 'https://example.com/profile1.jpg'),
('younghee', 'younghee@example.com', 'hash5678', '이영희', 'https://example.com/profile2.jpg'),
('minsu', 'minsu@example.com', 'hash9101', '박민수', 'https://example.com/profile3.jpg'),
('jieun', 'jieun@example.com', 'hash1121', '최지은', 'https://example.com/profile4.jpg'),
('sangho', 'sangho@example.com', 'hash3141', '정상호', 'https://example.com/profile5.jpg'),
('sora', 'sora@example.com', 'hash5161', '김소라', 'https://example.com/profile6.jpg'),
('junho', 'junho@example.com', 'hash7181', '이준호', 'https://example.com/profile7.jpg'),
('hana', 'hana@example.com', 'hash9202', '박하나', 'https://example.com/profile8.jpg');
```

**데이터 확인:**
```sql
SELECT user_id, username, full_name, created_at FROM users;
```

---

### 3.2. Posts 데이터

```sql
INSERT INTO posts (user_id, content) VALUES
(1, '제주도 여행 중 찍은 사진입니다! 🌴'),
(1, '오늘의 일상 기록'),
(2, '카페에서 맛있는 브런치 😋'),
(2, '새로 산 책 소개'),
(3, '서울 야경 촬영'),
(3, '주말 산책 코스'),
(4, '오늘 들은 노래 추천'),
(5, '헬스장 운동 루틴'),
(6, '강남 맛집 발견!'),
(7, '코딩 공부 중'),
(8, '그림 그리기 취미'),
(1, '일몰 사진');
```

**데이터 확인:**
```sql
SELECT p.post_id, u.username, p.content, p.created_at
FROM posts p
JOIN users u ON p.user_id = u.user_id
ORDER BY p.created_at DESC;
```

---

### 3.3. Media 데이터

```sql
INSERT INTO media (post_id, media_url, media_type, media_order) VALUES
(1, 'https://example.com/media/post1_1.jpg', 'IMAGE', 1),
(1, 'https://example.com/media/post1_2.jpg', 'IMAGE', 2),
(1, 'https://example.com/media/post1_3.jpg', 'IMAGE', 3),
(2, 'https://example.com/media/post2_1.jpg', 'IMAGE', 1),
(3, 'https://example.com/media/post3_1.jpg', 'IMAGE', 1),
(3, 'https://example.com/media/post3_2.jpg', 'IMAGE', 2),
(4, 'https://example.com/media/post4_1.jpg', 'IMAGE', 1),
(5, 'https://example.com/media/post5_1.jpg', 'IMAGE', 1),
(6, 'https://example.com/media/post6_1.mp4', 'VIDEO', 1),
(7, 'https://example.com/media/post7_1.jpg', 'IMAGE', 1),
(8, 'https://example.com/media/post8_1.jpg', 'IMAGE', 1),
(9, 'https://example.com/media/post9_1.jpg', 'IMAGE', 1),
(9, 'https://example.com/media/post9_2.jpg', 'IMAGE', 2),
(10, 'https://example.com/media/post10_1.jpg', 'IMAGE', 1),
(11, 'https://example.com/media/post11_1.jpg', 'IMAGE', 1),
(12, 'https://example.com/media/post12_1.jpg', 'IMAGE', 1),
(12, 'https://example.com/media/post12_2.jpg', 'IMAGE', 2),
(12, 'https://example.com/media/post12_3.jpg', 'IMAGE', 3),
(12, 'https://example.com/media/post12_4.jpg', 'IMAGE', 4);

```

**데이터 확인:**
```sql
SELECT p.post_id, u.username,
       COUNT(m.media_id) as media_count
FROM posts p
JOIN users u ON p.user_id = u.user_id
LEFT JOIN media m ON p.post_id = m.post_id
GROUP BY p.post_id, u.username;
```

---

### 3.4. Comments 데이터

```sql
INSERT INTO comments (post_id, user_id, content) VALUES
(1, 2, '멋진 사진이네요!'),
(1, 3, '저도 가보고 싶어요'),
(1, 1, '감사합니다!'),
(2, 4, '맛있어 보여요!'),
(2, 5, '좋은 사진이에요'),
(4, 1, '즐거운 시간 보내셨나 봐요!'),
(4, 6, '다음엔 저도 같이 가요!'),
(6, 7, '노을이 정말 예쁘네요'),
(6, 8, '멋진 풍경이네요!'),
(8, 2, '오늘도 파이팅!'),
(9, 3, '맛있겠다!'),
(9, 6, '완전 공감이에요!');
```

**데이터 확인:**
```sql
SELECT c.comment_id, u.username, p.post_id, c.content
FROM comments c
JOIN users u ON c.user_id = u.user_id
JOIN posts p ON c.post_id = p.post_id
ORDER BY c.post_id, c.comment_id;
```

---

### 3.5. Likes 데이터

```sql
INSERT INTO likes (post_id, user_id) VALUES
(1, 2), (1, 3), (1, 4), (1, 5), (1, 6),
(2, 3), (2, 4), (2, 5),
(3, 1), (3, 4),
(4, 1), (4, 3), (4, 5), (4, 6),
(5, 2),
(6, 1), (6, 2), (6, 4), (6, 5), (6, 7), (6, 8),
(7, 1), (7, 2),
(8, 1), (8, 3), (8, 4),
(9, 1), (9, 2), (9, 3), (9, 4), (9, 5),
(10, 2),
(11, 3), (11, 4),
(12, 2), (12, 3), (12, 4), (12, 5);
```

**데이터 확인:**
```sql
SELECT p.post_id, u.username,
       COUNT(l.like_id) as likes_count
FROM posts p
JOIN users u ON p.user_id = u.user_id
LEFT JOIN likes l ON p.post_id = l.post_id
GROUP BY p.post_id, u.username
ORDER BY likes_count DESC;
```

---

## 4. 제약조건 테스트

### 4.1. UNIQUE 제약조건 테스트

```sql
-- ❌ 실패: username 중복
INSERT INTO users (username, email, password_hash)
VALUES ('chulsoo', 'chulsoo2@example.com', 'hash1234');
-- Error: Duplicate entry 'chulsoo' for key 'username'

-- ✅ 성공: 다른 username
INSERT INTO users (username, email, password_hash)
VALUES ('chulsoo2', 'chulsoo2@example.com', 'hash1234');
```

---

### 4.2. FK CASCADE 테스트

```sql
-- 사용자 삭제 시 관련 데이터도 삭제되는지 확인

-- 1. user_id = 8 삭제 전 확인
SELECT COUNT(*) FROM posts WHERE user_id = 8;  -- 1
SELECT COUNT(*) FROM comments WHERE user_id = 8;  -- 2
SELECT COUNT(*) FROM likes WHERE user_id = 8;  -- 0

-- 2. 사용자 삭제
-- DELETE FROM users WHERE user_id = 8;

-- 3. 관련 데이터 확인 (모두 0이어야 함)
-- SELECT COUNT(*) FROM posts WHERE user_id = 8;  -- 0
-- SELECT COUNT(*) FROM comments WHERE user_id = 8;  -- 0
-- SELECT COUNT(*) FROM likes WHERE user_id = 8;  -- 0
```

